'use strict';

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

function _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError("this hasn't been initialised - super() hasn't been called"); } return call && (typeof call === "object" || typeof call === "function") ? call : self; }

function _inherits(subClass, superClass) { if (typeof superClass !== "function" && superClass !== null) { throw new TypeError("Super expression must either be null or a function, not " + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var sufficient = require('sufficient');

var poster = require('../../poster'),
    UpdateRequest = require('../../request/update'),
    UpdateResponse = require('../../response/update'),
    generateOperations = require('../../../operations/generate');

var updatePost = poster.updatePost,
    AsynchronousTask = sufficient.AsynchronousTask;

var UpdateAsynchronousTask = function (_AsynchronousTask) {
  _inherits(UpdateAsynchronousTask, _AsynchronousTask);

  function UpdateAsynchronousTask(userIdentifier, sessionIdentifier, workingContent, editableContent, callback) {
    _classCallCheck(this, UpdateAsynchronousTask);

    return _possibleConstructorReturn(this, (UpdateAsynchronousTask.__proto__ || Object.getPrototypeOf(UpdateAsynchronousTask)).call(this, asynchronousMethod, userIdentifier, sessionIdentifier, workingContent, editableContent, callback));
  }

  return UpdateAsynchronousTask;
}(AsynchronousTask);

module.exports = UpdateAsynchronousTask;

function asynchronousMethod(userIdentifier, sessionIdentifier, workingContent, editableContent, callback) {
  var operations = generateOperations(workingContent, editableContent),
      updateRequest = UpdateRequest.fromOperationsUserIdentifierAndSessionIdentifier(operations, userIdentifier, sessionIdentifier),
      json = updateRequest.toJSON();

  updatePost(json, function (json) {
    var updateResponse = UpdateResponse.fromJSON(json),
        sessionExpired = updateResponse.getSessionExpired(),
        pendingOperations = updateResponse.getPendingOperations();

    callback(sessionExpired, pendingOperations);
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL2VzNi9leGFtcGxlL3Rhc2svYXN5bmNocm9ub3VzL3VwZGF0ZS5qcyJdLCJuYW1lcyI6WyJzdWZmaWNpZW50IiwicmVxdWlyZSIsInBvc3RlciIsIlVwZGF0ZVJlcXVlc3QiLCJVcGRhdGVSZXNwb25zZSIsImdlbmVyYXRlT3BlcmF0aW9ucyIsInVwZGF0ZVBvc3QiLCJBc3luY2hyb25vdXNUYXNrIiwiVXBkYXRlQXN5bmNocm9ub3VzVGFzayIsInVzZXJJZGVudGlmaWVyIiwic2Vzc2lvbklkZW50aWZpZXIiLCJ3b3JraW5nQ29udGVudCIsImVkaXRhYmxlQ29udGVudCIsImNhbGxiYWNrIiwiYXN5bmNocm9ub3VzTWV0aG9kIiwibW9kdWxlIiwiZXhwb3J0cyIsIm9wZXJhdGlvbnMiLCJ1cGRhdGVSZXF1ZXN0IiwiZnJvbU9wZXJhdGlvbnNVc2VySWRlbnRpZmllckFuZFNlc3Npb25JZGVudGlmaWVyIiwianNvbiIsInRvSlNPTiIsInVwZGF0ZVJlc3BvbnNlIiwiZnJvbUpTT04iLCJzZXNzaW9uRXhwaXJlZCIsImdldFNlc3Npb25FeHBpcmVkIiwicGVuZGluZ09wZXJhdGlvbnMiLCJnZXRQZW5kaW5nT3BlcmF0aW9ucyJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7O0FBRUEsSUFBTUEsYUFBYUMsUUFBUSxZQUFSLENBQW5COztBQUVBLElBQU1DLFNBQVNELFFBQVEsY0FBUixDQUFmO0FBQUEsSUFDTUUsZ0JBQWdCRixRQUFRLHNCQUFSLENBRHRCO0FBQUEsSUFFTUcsaUJBQWlCSCxRQUFRLHVCQUFSLENBRnZCO0FBQUEsSUFHTUkscUJBQXFCSixRQUFRLDhCQUFSLENBSDNCOztBQUtNLElBQUVLLFVBQUYsR0FBaUJKLE1BQWpCLENBQUVJLFVBQUY7QUFBQSxJQUNFQyxnQkFERixHQUN1QlAsVUFEdkIsQ0FDRU8sZ0JBREY7O0lBR0FDLHNCOzs7QUFDSixrQ0FBWUMsY0FBWixFQUE0QkMsaUJBQTVCLEVBQStDQyxjQUEvQyxFQUErREMsZUFBL0QsRUFBZ0ZDLFFBQWhGLEVBQTBGO0FBQUE7O0FBQUEsMklBQ2xGQyxrQkFEa0YsRUFDOURMLGNBRDhELEVBQzlDQyxpQkFEOEMsRUFDM0JDLGNBRDJCLEVBQ1hDLGVBRFcsRUFDTUMsUUFETjtBQUV6Rjs7O0VBSGtDTixnQjs7QUFNckNRLE9BQU9DLE9BQVAsR0FBaUJSLHNCQUFqQjs7QUFFQSxTQUFTTSxrQkFBVCxDQUE0QkwsY0FBNUIsRUFBNENDLGlCQUE1QyxFQUErREMsY0FBL0QsRUFBK0VDLGVBQS9FLEVBQWdHQyxRQUFoRyxFQUEwRztBQUN4RyxNQUFNSSxhQUFhWixtQkFBbUJNLGNBQW5CLEVBQW1DQyxlQUFuQyxDQUFuQjtBQUFBLE1BQ01NLGdCQUFnQmYsY0FBY2dCLGdEQUFkLENBQStERixVQUEvRCxFQUEyRVIsY0FBM0UsRUFBMkZDLGlCQUEzRixDQUR0QjtBQUFBLE1BRU1VLE9BQU9GLGNBQWNHLE1BQWQsRUFGYjs7QUFJQWYsYUFBV2MsSUFBWCxFQUFpQixVQUFTQSxJQUFULEVBQWU7QUFDOUIsUUFBTUUsaUJBQWlCbEIsZUFBZW1CLFFBQWYsQ0FBd0JILElBQXhCLENBQXZCO0FBQUEsUUFDQ0ksaUJBQWlCRixlQUFlRyxpQkFBZixFQURsQjtBQUFBLFFBRU1DLG9CQUFvQkosZUFBZUssb0JBQWYsRUFGMUI7O0FBSUFkLGFBQVNXLGNBQVQsRUFBeUJFLGlCQUF6QjtBQUNELEdBTkQ7QUFPRCIsImZpbGUiOiJ1cGRhdGUuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHN1ZmZpY2llbnQgPSByZXF1aXJlKCdzdWZmaWNpZW50Jyk7XG5cbmNvbnN0IHBvc3RlciA9IHJlcXVpcmUoJy4uLy4uL3Bvc3RlcicpLFxuICAgICAgVXBkYXRlUmVxdWVzdCA9IHJlcXVpcmUoJy4uLy4uL3JlcXVlc3QvdXBkYXRlJyksXG4gICAgICBVcGRhdGVSZXNwb25zZSA9IHJlcXVpcmUoJy4uLy4uL3Jlc3BvbnNlL3VwZGF0ZScpLFxuICAgICAgZ2VuZXJhdGVPcGVyYXRpb25zID0gcmVxdWlyZSgnLi4vLi4vLi4vb3BlcmF0aW9ucy9nZW5lcmF0ZScpO1xuXG5jb25zdCB7IHVwZGF0ZVBvc3QgfSA9IHBvc3RlcixcbiAgICAgIHsgQXN5bmNocm9ub3VzVGFzayB9ID0gc3VmZmljaWVudDtcblxuY2xhc3MgVXBkYXRlQXN5bmNocm9ub3VzVGFzayBleHRlbmRzIEFzeW5jaHJvbm91c1Rhc2sge1xuICBjb25zdHJ1Y3Rvcih1c2VySWRlbnRpZmllciwgc2Vzc2lvbklkZW50aWZpZXIsIHdvcmtpbmdDb250ZW50LCBlZGl0YWJsZUNvbnRlbnQsIGNhbGxiYWNrKSB7XG4gICAgc3VwZXIoYXN5bmNocm9ub3VzTWV0aG9kLCB1c2VySWRlbnRpZmllciwgc2Vzc2lvbklkZW50aWZpZXIsIHdvcmtpbmdDb250ZW50LCBlZGl0YWJsZUNvbnRlbnQsIGNhbGxiYWNrKVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gVXBkYXRlQXN5bmNocm9ub3VzVGFzaztcblxuZnVuY3Rpb24gYXN5bmNocm9ub3VzTWV0aG9kKHVzZXJJZGVudGlmaWVyLCBzZXNzaW9uSWRlbnRpZmllciwgd29ya2luZ0NvbnRlbnQsIGVkaXRhYmxlQ29udGVudCwgY2FsbGJhY2spIHtcbiAgY29uc3Qgb3BlcmF0aW9ucyA9IGdlbmVyYXRlT3BlcmF0aW9ucyh3b3JraW5nQ29udGVudCwgZWRpdGFibGVDb250ZW50KSxcbiAgICAgICAgdXBkYXRlUmVxdWVzdCA9IFVwZGF0ZVJlcXVlc3QuZnJvbU9wZXJhdGlvbnNVc2VySWRlbnRpZmllckFuZFNlc3Npb25JZGVudGlmaWVyKG9wZXJhdGlvbnMsIHVzZXJJZGVudGlmaWVyLCBzZXNzaW9uSWRlbnRpZmllciksXG4gICAgICAgIGpzb24gPSB1cGRhdGVSZXF1ZXN0LnRvSlNPTigpO1xuXG4gIHVwZGF0ZVBvc3QoanNvbiwgZnVuY3Rpb24oanNvbikge1xuICAgIGNvbnN0IHVwZGF0ZVJlc3BvbnNlID0gVXBkYXRlUmVzcG9uc2UuZnJvbUpTT04oanNvbiksXG5cdFx0XHRcdFx0c2Vzc2lvbkV4cGlyZWQgPSB1cGRhdGVSZXNwb25zZS5nZXRTZXNzaW9uRXhwaXJlZCgpLFxuICAgICAgICAgIHBlbmRpbmdPcGVyYXRpb25zID0gdXBkYXRlUmVzcG9uc2UuZ2V0UGVuZGluZ09wZXJhdGlvbnMoKTtcblxuICAgIGNhbGxiYWNrKHNlc3Npb25FeHBpcmVkLCBwZW5kaW5nT3BlcmF0aW9ucyk7XG4gIH0pO1xufVxuIl19